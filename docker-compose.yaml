services:
  backend:
    container_name: django-backend
    build:
      context: ./backend/
      dockerfile: Dockerfile
    ports:
      - 8000:8000
      - 5678:5678
    volumes:
      - ./backend:/app/backend
      - staticfiles:/app/backend/static
      - mediafiles:/app/backend/mediafiles

  frontend:
    container_name: react-frontend
    build:
      context: ./frontend/
      dockerfile: Dockerfile
    ports:
      - 3000:5173
    volumes:
      - ./frontend:/app/frontend
      - frontend_node_modules:/app/frontend/node_modules
      - frontend_pnpm_store:/app/frontend/.pnpm-store

  nginx:
    image: nginx:1.23.3-alpine
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./certs:/etc/nginx/certs
      - staticfiles:/opt/backend/static:ro
      - mediafiles:/opt/backend/mediafiles:ro
    command: nginx -g 'daemon off;'

volumes:
  frontend_node_modules:
  frontend_pnpm_store:
  staticfiles:
  mediafiles:
